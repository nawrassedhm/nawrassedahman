---
title: Setting up Dark Theme with Remix and Stitches
description: >-
  A short walkthrough of setting up CSS-in-JS theming functionality with
  Stitches and Remix leveraging SSR color-scheme preferences.
date: Dec 2021
image: remix
---

import one from 'images/remix-stitches/one.png'

<PageHeader title={title} description={description} />

<Image src={one} alt="Documentation graphic" />

<Aside>
  **Want the solution and not a story?** [Check out the example repo on
  GitHub](https://github.com/rossmoody/stitches-remix).
</Aside>

I have been working on a side project called [Cryptocons.io](https://github.com/rossmoody/cryptocons) for the past few months. It‚Äôs not even close to presentable, but I typically use side projects to try new frameworks and tools. This time, I wanted to try a combination of 3 tools I have been gushing over lately: [Remix](https://remix.run/), [Stitches](https://stitches.dev/), and [Radix](http://radix-ui.com).

Setting up a Remix project was really easy. I remarked about this on Twitter and how excited I am for how Remix prompts a different component/project structure approach.

So far it feels like Remix blurs the line between pages, components, and state in how the structure of the project‚Äôs folder architecture dictates the actual UI. Typically I set up a project by creating a page layout and passing components in willy-nilly. I then handle each component child‚Äôs data and state via some form of Context Provider.

Remix feels conceptually similar but where files live and how they are named seem to play a much more significant role. I like this about it so far (time will tell long-term). It inherently encourages me to be consistent and intentional about my project's structure. Not solving every problem in the context of a React hook has already caused me to learn quite a lot about web development and how web pages are fundamentally created.

## Setting Up Stitches and Remix

I ran into some snags for setting up Stitches and Remix at first. The setup was a breeze: install both packages, run the dev server, and import a Stitches styled component into a page route. However, the nuance of SSR, having the site load without an initial flash of unstyled content ([also known as FART](https://css-tricks.com/flash-of-inaccurate-color-theme-fart/)), and tracking a user‚Äôs theme state were a little trickier. This is especially true if I wanted to detect prefers-color-scheme dynamically.

### ‚ùå Attempt #1

At first, I set up the site using [Stitches SSR documentation](https://stitches.dev/docs/server-side-rendering). My styles were rendered correctly, but this approach caused some odd hydration errors in the console and didn‚Äôt fix my FART. Interestingly, my styles rendered fine without doing this part at all.

### üòë Attempt #2

I was about to start following the [CSS-in-JS instructions on Remix‚Äôs site](https://remix.run/docs/en/v1/guides/styling#css-in-js-libraries), and I imagine it would have worked just fine, but I wanted to eliminate the need for a ‚Äúthrowaway‚Äù render.

Anthony on [Twitter](https://twitter.com/garand/status/1470408716981837834) suggested loading the CSS via a loader function in the `root.tsx` server file. This eliminated the hydration warning, but I got a FART on my screen during refreshes.

### üéâ Winning Attempt #3

[Jenna Smith](https://twitter.com/jjenzz) from Modulz hopped in [with a simple gist](https://twitter.com/jjenzz/status/1472500698185191428) that worked like a charm. I have to imagine altering the head tag via regex isn‚Äôt the ideal solution, but it works. Speculating from the tweet, Stitches may be hot on the trail of a static CSS mechanism, which will make all this a whole lot easier.

If you want one theme without a color scheme and no FART, your work is done üéâ. Altering the head element from the server loads all the necessary styles ahead of paint.

## Stitches and Remix Color Scheme Theme Setup

Most of my experience with web development so far is front-of-the-frontend and has sidestepped server considerations. I typically use [Gatsby](http://gatsbyjs.com) or [Next](http://nextjs.org) with CSS-in-JS. Theme considerations and state in those cases are taken care of via Javascript on the client-side by a supplied ThemeProvider or custom ThemeContext that addresses the FART.

This was a unique opportunity to learn how to lean on the [browser‚Äôs Sec-CH-Prefers-Color-Scheme client headers](https://web.dev/user-preference-media-features-headers/). Remix embraces the server, time to get on board.

### 1\. Create the theming color aliases

For our example, let‚Äôs set up the minimal theme functionality for a demo. This means setting color aliases for text color, anchor color, and our body‚Äôs background color in both light and dark themes.

### 2\. Tracking Color Scheme State

We want our theming functionality to have pretty simple logic:

1.  If the user has set a theme manually for the site (determined by a theme cookie we will create), we set the selected theme
2.  If the user hasn‚Äôt set a theme manually and has a user `prefers-color-mode` preference, we grab it from the request header (so we can process it server-side) and set the theme accordingly
3.  If neither of these is true, we set to our default theme: `light`

### 3\. Setting the correct theme

I borrowed an approach I picked up from [Radix Design System GitHub](https://github.com/radix-ui/design-system/blob/master/custom/DarkThemeButton.tsx). They have a DarkMode button component that essentially adds or removes the `darkTheme` class name to the body element.

```css
[@media](http://twitter.com/media 'Twitter profile for @media') {
 :root,.t-cIBkYY {
 --colors-text: #191919;
 --colors-bgBody: #f8f9fa;
 --colors-anchor: DarkGoldenRod
 }

 .dark {
 --colors-text: #f8f9fa;
 --colors-bgBody: #191919;
 --colors-anchor: BlanchedAlmond
 }
```

I love how simple this is. The default theme‚Äôs `:root` css color alias variables are overridden via specificity by using the className of the dark theme. In our case, we are aligning the names of the themes to the browser‚Äôs `color-scheme` strings but really the `class="light"`has no effect.

Stitches generates a unique class hash for the default theme (which is light in our case) and we specify `class="dark"`for our `darkTheme` class to override it.

## Set up the theme switcher

The last piece of the puzzle is to put a Button on a route that changes the cookie‚Äôs `theme-token` value. This is the code snippet I used in my `index.tsx` file but I imagine there are lots of ways you could do this.

If you have any suggestions for ways to improve this documentation or the [GitHub example repo](https://github.com/rossmoody/stitches-remix/blob/main/stitches.config.ts), lemme have ‚Äòem.

---

## Resources

- [**Hello darkness, my old friend**](https://web.dev/prefers-color-scheme/)**.** Amazing read on `prefers-color-scheme` functionality and the history of dark-mode.
- [**Improved dark mode default styling**](https://web.dev/color-scheme/): The color-scheme CSS property and the corresponding meta tag
